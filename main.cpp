// ----- –°–ò–°–¢–ï–ú–ù–ï –Ø–î–†–û ----- // 
#include "config.h" // –ü—ñ–¥–∫–ª—é—á–∞—î–º –ø—ñ–Ω–∏ 
#include "system.h" // –ü—ñ–¥–∫–ª—é—á–∞—î–º –æ–±—â–∏ —Ñ–∞–π–ª–∏

// ----- API key, CX ----- //
const char* apiKey = "AIzaSy...";   // –∫–ª—é—á API
const char* cx = "abcd123:xyz";     // —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä CSE



// ----- –°—Ç–≤–æ—Ä—é—î—Å –æ–±'—î–∫—Ç–∏ ----- //
Preferences prefs;                           // –°—Ç–≤–æ—Ä—é—î–º –æ–±'—î–∫—Ç –¥–ª—è EPRROM –ø–∞–º'—è—Ç—ñ
GyverOLED<SSD1306_128x64, OLED_BUFFER> oled; // –°—Ç–≤–æ—Ä—é—î–º –æ–±'—î–∫—Ç –¥–ª—è –¥–∏—Å–ø–ª–µ—é
File file;                                   // –°—Ç–≤–æ—Ä—é—î–º –æ–±'—î–∫—Ç –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ñ–∞–π–ª–∞–º–∏ SD –∫–∞—Ä—Ç–∏


// ----- –ó–º—ñ–Ω–∞ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º –Ω–∞ SD ----- //
const char* firmwarePath = "/apps/app.bin"; // /apps - –Ω–∞—à–∞ –ø–∞–ø–∫–∞ —É —è–∫—ñ–π –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è —É—Å—ñ –ø—Ä–æ–≥—Ä–∞–º–∏
                                            // /app.bin - —Ç—É—Ç –≤–∫–∞–∑—É—î–º –ø—Ä–æ–≥—Ä–∞–º—É —è–∫—É —Ç—Ä–µ–±–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
const char* system_OS = "/system/os.bin";   // /system - –ø–∞–∫–ø–∫–∞ –∑ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é
                                            // /os.bin - —Ñ–∞–π–ª –≤ —è–∫–æ–º—É –∑–∞–ø–∏—Å–∞–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞
const char* system_version = "/system/os_version.txt"; // /system/os_version.txt - –§–∞–π–ª —É —è–∫–æ–º—É –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤–µ—Ä—Å—ñ—è –ø—Ä–æ—à–∏–≤–∫–∏
const char* notes_txt = "/apps/notes";      // /apps/notes - —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—ñ–≤ txt –Ω–æ—Ç–∞—Ç–∫–∏
uint8_t buffer[BUFFER_SIZE];                // –£ —Ü–µ–π –º–∞—Å–∏–≤ —Ç–∏–º —á–∞—Å–æ–≤–æ –∑–∞–ø–∏—Å—É—é—Ç—Å—è —Å—á–∏—Ç–∞–Ω—ñ —Ñ–∞–π–ª–∏ –∑ SD
// ----- –°—Ç–≤–æ—Ä—é—î–º –º–∞—Å–∏–≤ —É —è–∫–æ–º—É –±—É–¥—É—Ç—å –≤—Å—ñ –Ω–∞–∑–≤–∏ –ø—Ä–æ–≥—Ä–∞–º ----- //
const char* program_list[] = {
    // ===== üß© –°–∏—Å—Ç–µ–º–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ =====
  "Settings",
  "Wi-Fi Manager",
  "Clock",
  "File Explorer",
  "System Info",
  "Updater",

  // ===== ‚öôÔ∏è –ö–æ—Ä–∏—Å–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏ =====
  "Calculator",
  "Notes",
  "Paint",
  "Gallery",
  "Music Player",
  "Terminal",
  "Broswer",

  // ===== üéÆ –Ü–≥—Ä–∏ =====
  "Snake",
  "Tetris",
  "2048",
  "Doom Mini",
  "Flappy Bird",
  "Pong"
};
int visibleItems = 8;  // —Å—Ç–≤–æ—Ä—é—î–º–æ –∑–º—ñ–Ω—É  –¥–ª—è —Ç–æ–≥–æ —â–æ–± –∑–Ω–∞—Ç–∏ —Å–∫—ñ–ª—å–∫–∏ –≤–∏–≤–æ–¥–∏—Ç–∏ –ø—É–Ω–∫—Ç—ñ–≤ –Ω–∞ –¥–∏—Å–ø–ª–µ–π
int current = 0;       // –Ω–æ–º–µ—Ä –æ–±—Ä–∞–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É/–≤–∫–∞–∑—ñ–≤–Ω–∏–π –¥–ª—è –∫—É—Ä—Å–æ—Ä—É
const int program_items = sizeof(program_list) / sizeof(program_list[0]);


// ----- –ó–º—ñ–Ω—ñ –¥–ª—è –≤—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É–≤–∞–Ω–Ω—è –∫–æ—Ä–¥–∏–Ω–∞—Ç –±—É–∫–≤ ----- //
int char_x = 0;
int char_y = 0;


// ----- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤ –¥–ª—è —Ä–æ–±–æ—Ç–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏ ----- //
GButton but_left(button_LEFT);   // –ü—ñ–¥–∫–ª—é—á–∞—î–º –∫–Ω–æ–ø–∫—É LEFT
GButton but_right(button_RIGHT); // –ü—ñ–¥–∫–ª—é—á–∞—î–º –∫–Ω–æ–ø–∫—É RIGHT
GButton but_up(button_UP);       // –ü—ñ–¥–∫–ª—é—á–∞—î–º –∫–Ω–æ–ø–∫—É UP
GButton but_down(button_DOWN);   // –ü—ñ–¥–∫–ª—é—á–∞—î–º –∫–Ω–æ–ø–∫—É DOWN
GButton but_ok(button_OK);       // –ü—ñ–¥–∫–ª—é—á–∞—î–º –∫–Ω–æ–ø–∫—É OK



// ----- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä—ñ–≤ ----- //
unsigned long time_button;         // —Ç–∞–π –º–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ (–õ–∏—à–µ –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è)
unsigned long time_menu_scrol;     // –¢–∞–π–º–µ—Ä –¥–ª—è —Å–∫—Ä–æ–ª—É –º–µ–Ω—é
unsigned long time_oled;           // –¢–∞–π–º–µ—Ä –¥–ª—è –¥–∏—Å–ø–ª–µ—è
unsigned long time_delay;
unsigned long time_text;           // –¢–∞–π–º–µ—Ä –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–æ–≥–æ –∑–Ω–∞–∫—É: "_" –≤ –º–æ—Ä–≥–∞—é—á–æ–º—É —Å—Ç–∞–Ω—ñ 

int time_react = 90;         // –®–≤–∏–¥–∫—ñ—Å—å=—Ç—å –æ–±—Ä–æ–±–∫–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω—å –∫–Ω–æ–ø–æ–∫ (–õ–∏—à–µ –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è)
int time_text_millis = 500;

// ----- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ----- //
int fontSize = 1;      // —Ä–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É
int brightness = 255;  // —è—Å–∫—Ä–∞–≤—ñ—Å—Ç—å
bool darkMode = false; // —Ç–µ–º–∞ (–Ω–∞ –º–∞–π–±—É—Ç–Ω—î)


// ----- –°—Ç–∞–Ω–∏ –°–∏—Å—Ç–µ–º–∏ ----- //
SystemState state = MENU;  // –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω—ñ



// ----- –ó–º—ñ–Ω—ñ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ SD –∫–∞—Ä—Ç–æ—é ----- //

void setup() {
  // ----- –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º —Ä–µ–∂–∏–º–∏ –ø—ñ–Ω—ñ–≤ -----//
  pinMode(button_UP, INPUT_PULLUP);
  pinMode(button_DOWN, INPUT_PULLUP);
  pinMode(button_LEFT, INPUT_PULLUP);
  pinMode(button_RIGHT, INPUT_PULLUP);
  pinMode(button_OK, INPUT_PULLUP);

  oled.init();      // —ñ–Ω—Ü—ñ–ª—ñ–∑—ñ—Ä—Ü—î–º –¥–∏—Å–ø–ª–µ–π
  delay(100);        // –î–∞—î–º —á–∞—Å –¥–ª—è —ñ–Ω—Ü—ñ–ª—ñ–∑–∞—Ü—ñ—ó

  // ----- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è EPRROM ----- //
  prefs.begin("SetingUSER"); // –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –ø—Ä–æ—Å—Ç—ñ—Ä —è–∫—â–æ —Ç–∞–∫–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É –Ω–µ —ñ—Å–Ω—É—î —Ç–æ —Å—Ç–≤–æ—Ä—é—î–º

  // ----- –Ø—Å–∫—Ä–∞–≤—ñ—Å—Ç—å OLED ----- //
  if (!prefs.isKey("oledContrast")) {   
    prefs.putInt("oledContrast", 255);  
  }

  // ----- –†–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É ----- //
  if (!prefs.isKey("fontSize")) { 
    prefs.putInt("fontSize", 1);  
  }

  // ----- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–¥–∏–º–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –º–µ–Ω—é ----- //
  if (!prefs.isKey("visibleItems")) { 
    prefs.putInt("visibleItems", 8);  
  }

  // ----- –ó—á–∏—Ç—É—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ ----- //
  fontSize     = prefs.getInt("fontSize", 1);
  brightness   = prefs.getInt("oledContrast", 255);
  visibleItems = prefs.getInt("visibleItems", 8);
  prefs.end(); // –ó–∞–∫—Ä–∏–≤–∞—î–º EPRROM
  // ----- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–∏—Å–ø–ª–µ—é ----- //
  oled.setScale(fontSize); 
  oled.setContrast(brightness);


  // ----- –í–∏–≤–æ–¥–∏–º –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ –¥–∏—Å–ø–ª–µ–π —Ç–µ–∫—Å—Ç ----- // 
  oled.clear();     // –ß–∏—Å—Ç–∏–º –¥–∏—Å–ø–ª–µ–π
  oled.update();    // –æ–Ω–æ–≤–ª—é—î–º –¥–∏—Å–ø–ª–µ–π
  oled.home();      // –°—Ç–∞–≤–∏–º –∫—É—Ä—Å–æ—Ä –Ω–∞ 0 0
  oled.print("loading system..."); // –í–∏–≤–æ–¥–∏–º —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –Ω–∞ –¥–∏—Å–ø–ª–µ–π
  oled.update();    // –æ–±–Ω–æ–≤–ª—è—î–º –¥–∏—Å–ø–ª–µ–π
  // ----- ----- //
  Serial.begin(9600); // –Ü–Ω—Ü—ñ–ª—ñ–∑—ñ—Ä—É—î–º serial –ø–æ—Ä—Ç
  delay(100);



  // ----- –Ü–Ω—ñ—Ü—ñ–ª—ñ–∑–∞—Ü—ñ—è —ñ–Ω—à–∏—Ö –æ–±'—è–∫—Ç—ñ–≤ ----- //
  SPI.begin(SD_CLK, SD_MISO, SD_MOSI, SD_CS);// –Ü–Ω—Ü—ñ–ª—ñ–∑—ñ—Ä—É—î–º SPI –∑ —Ç–∏–º–∏ –ø—ñ–Ω–∞–º–∏ —è–∫—ñ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω—ñ  
  if (!SD.begin(SD_CS)) {                    // –Ü–Ω—Ü—ñ–ª—ñ–∑—ñ—Ä—É—î–º SD –∫–∞—Ä—Ç—É
    Serial.println("‚ùå –ü–æ–º–∏–ª–∫–∞: SD-–∫–∞—Ä—Ç—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–±–æ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ!");
    return;
  }
  Serial.println("‚úÖ SD-–∫–∞—Ä—Ç—É —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ.");
  delay(100);
  //uint64_t cardSize = SD.cardSize() / (1024 * 1024); // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º —Å–∫—ñ–ª—å–∫–∏ –ø–∞–º'—è—Ç—ñ –Ω–∞ SD –∫–∞—Ä—Ç—ñ —Ç–∞ –∑–∞–ø–∏—Å—É—î–º —É –∑–º—ñ–Ω—É
  
  
  // ----- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è WiFi ----- //
  prefs.begin("wifi", false);     // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º –ø—Ä–æ—Å—Ç—ñ—Ä wifi —É —Ü—å–æ–º—É –ø—Ä–æ—Å—Ç–æ—Ä—ñ –∑–±–µ—Ä—ñ–≥—ñ—é—Ç—Å—è –ø–∞—Ä–æ–ª—ñ —Ç–∞ –Ω–∞–∑–≤–∏ –≤–∞–π—Ñ–∞–π, —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î —Å—Ç–≤–æ—Ä—é—î–º

  String savedSsid = prefs.getString("ssid", "");  // –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π SSID (–∞–±–æ "" —è–∫—â–æ –Ω–µ–º–∞) (SSID - NAME)
  String savedPass = prefs.getString("pass", "");  // –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –ø–∞—Ä–æ–ª—å
                                                   // –¢–∞ –∑–∞–ø–∏—Å—É—î–º —É—Å–µ —É –∑–º—ñ–Ω—ñ
  prefs.end(); // –ó–∞–∫—Ä–∏–≤–∞—î–º EPRROM
  if (savedSsid.length()) { // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º —á–∏ —î –≤ –ø–∞–º'—è—Ç—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π Ssid —è–∫—â–æ —î —Ç–æ –≤–∏–∫–æ–Ω—É—î–º –∫–æ–¥ –¥–∞–ª—ñ
    Serial.println("–°–ø—Ä–æ–±–∞ –∞–≤—Ç–æ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ: " + savedSsid); // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ —è–∫–æ—ó –º–µ—Ä–µ–∂—ñ –º–∏ –ø—ñ–¥–∫–ª—é—á–∞—î–º–æ—Å—å

    WiFi.mode(WIFI_STA); // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º —Ä–µ–∂–∏–º —Ä–æ–±–æ—Ç–∏ WiFi_STA —Ç–æ–ø—Ç–æ –∫–ª—ñ—î–Ω—Ç—å—Å—å–∫–∏–π —Ä–µ–∂–∏–º —Ü–µ –∫–æ–ª–∏ ESP32 –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ –º–µ—Ä–µ–∂—ñ,
                         // –ê –Ω–µ —Å—Ç–≤–æ—Ä—é—î –≤–ª–∞—Å–Ω—É —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø—É
    WiFi.begin(savedSsid.c_str(), savedPass.c_str()); // –ó–∞—Ä—É—Å–∫–∞—î–º–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –º–µ—Ä–µ–∂—ñ –≤–∞–π—Ñ–∞–π
    
    unsigned long t0 = millis();

    while (millis() - t0 < 10000) {             // –î–∞—î–º–æ 10 —Å–µ–∫. —â–æ–± –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ WiFi
      if (WiFi.status() == WL_CONNECTED) break; // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º —è–∫—â–æ –≤–∞–π—Ñ–∞–π –ø—ñ–¥–∫–ª—é—á–∏–≤—Å—è —Ç–æ –≤–∏—Ö–æ–¥–∏–º –∑ —Ü–∏–∫–ª—É
      delay(100);                               // –ß–µ–∫–∞—î–º–æ 100 –º—ñ–ª–µ—Å–µ–∫—É–Ω–¥ —â–æ–± –Ω–µ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É
    }

    if (WiFi.status() == WL_CONNECTED) {
      Serial.println("–ú–µ—Ä–µ–∂–∞ —É—Å–ø—ñ—à–Ω–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∞");
      return; // –í–∏—Ö–æ–¥–∏–º–æ –∑ setup —Ç–∞ –ø–æ—á–∏–Ω–∞—î–º –æ—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª
    } else {
      Serial.println("–ù–µ –≤–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –º–µ—Ä–µ–∂—ñ");
      WiFi.disconnect(true); // –†–æ–∑—Ä–∏–≤–∞—î–º –ø–æ—Ç–æ—á–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è —è–∫—â–æ –≤–æ–Ω–æ –±—É–ª–æ, true - –∑–∞–±—É–≤–∞—î–º –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥—Ä–∞–π–≤–µ—Ä–∞ WiFi (–û—á–∏—â–∞—î –∫–µ—à)
      return;
    }




  // ----- Hello User ----- //
  oled.clear();              // –ß–∏—Å—Ç–∏–º –¥–∏—Å–ø–ª–µ–π
  if (visibleItems == 8) {
    oled.setCursor(34, 3);     // –°—Ç–∞–≤–∏–º –∫—É—Ä—Å–æ—Ä –Ω–∞ 34 —Ç–∞ –Ω–∞ 3 —Å—Ç—Ä–æ–∫—É –ø–æ Y
    oled.print("Hello User");  // –í–∏–≤–æ–¥–∏–º —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –Ω–∞ –¥–∏—Å–ø–ª–µ–π
  } else {
    oled.setCursor(4, 3);     // –°—Ç–∞–≤–∏–º –∫—É—Ä—Å–æ—Ä –Ω–∞ 4 —Ç–∞ –Ω–∞ 3 —Å—Ç—Ä–æ–∫—É –ø–æ Y
    oled.print("Hello User");  // –í–∏–≤–æ–¥–∏–º —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –Ω–∞ –¥–∏—Å–ø–ª–µ–π
  }
  oled.update();             // –æ–Ω–æ–≤–ª—é—î–º –¥–∏—Å–ø–ª–µ–π
  delay(2000);


  
  }

}

void loop() {
  // ----- –û–Ω–æ–≤–ª—é—î–º –∫–Ω–æ–ø–∫–∏ ----- //
  but_left.tick();
  but_right.tick();
  but_up.tick();
  but_down.tick();

  // ----- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º —è–∫–∏–π –∑–∞—Ä–∞–∑ —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ ----- //
  switch (state) {        // ----- –õ–∏—à–µ —Å—Ç–∞–Ω–∏ –≤—Å—Ç—Ä–æ—î–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º –≤ —Å–∏—Å—Ç–µ–º—É —ñ–Ω—à—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –∑–∞–ø–∏—Å–∞–Ω—ñ–∏ –Ω–∞ SD –∫–∞—Ä—Ç—É ----- // 
    case MENU:                  // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –º–µ–Ω—é ----- //
    handleButtons();
    drawingOLED();
    break;

    case APP_SETTINGS:          // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ----- //
    button_setting();
    seting();
    break;

    case APP__WiFiMANAGER:      // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ WiFi –º–µ–Ω–µ–¥–∂–µ—Ä ----- //
    button_setting();
    WiFiManager();
    break;

    case APP_CLOCK:             // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –≥–æ–¥–∏–Ω–∏–∫ ----- //
    button_setting();
    app_clock();
    break;

    case APP_FILEEXPLORER:      // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª–∞–º–∏ –Ω–∞ SD, EPRROM ----- //
    button_setting();
    fileexplorer();
    break;

    case APP_SYSTEMINFO:        // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –ø—Ä–æ —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ ----- //
    button_setting();
    systemInfo();
    break;

    case APP_UPDATER:           // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è OS ----- //
    button_setting();
    systemUpdate();
    break;

    case APP_CALKULATOR:        // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä ----- //
    break;

    case APP_NOTES:             // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω–æ—Ç–∞—Ç–∫–∏ ----- //
    button_setting();
    notes();
    break;

    case APP_TERMINAL:          // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ —Ç–µ—Ä–º—ñ–Ω–∞–ª –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —É—Å—ñ–º ----- //
    terminal_button();
    terminal();
    break;

    case APP_BROSWER:           // ----- –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤ –≤ Google ----- //
    button_setting();
    broswer();
    break;
  }


}



// ----- –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω—å –∫–Ω–æ–ø–æ–∫ ----- //
void handleButtons() {

  if (millis() - time_button > time_react) { // ----- –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º —Ç–∞–π–º–µ—Ä ----- //
    time_button = millis();
    // ----- –ö–ù–û–ü–ö–ê UP ----- //
    if (digitalRead(button_UP) == LOW) {
      if (current != 0) {
        current--;
      } else {
        current = program_items - 1;
      }
    }
    // ----- –ö–ù–û–ü–ö–ê DOWN ----- //
    if (digitalRead(button_DOWN) == LOW) {
      if (current < program_items - 1) {
        current++;
      } else {
        current = 0;
      }
    }
    // ----- –ö–ù–û–ü–ö–ê OK ----- //
    if (digitalRead(button_OK) == LOW) {
      openProgram(current);
    }
  }

  
}
 


// ----- –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–≤–æ–¥—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–∞ –¥–∏—Å–ø–ª–µ–π ----- //
void drawingOLED() {

  if (millis() - time_oled > 30) {
    time_oled = millis();
    oled.clear();
    int page = current / visibleItems; // –í–∏–∑–Ω–∞—á–∞—î–∂–º —è–∫–∞ –∑–∞—Ä–∞–∑ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ 0 - 1 —Å—Ç–æ—Ä—ñ–Ω–∫–∞, 1 - –¥—Ä—É–≥–∞
    int start = page * visibleItems;   // –í–∏–∑–Ω–∞—á–∞—î–º –∑ —è–∫–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç—É –ø–æ—á–∞—Ç–∏ –≤–∏–≤–æ–¥–∏—Ç–∏ –º–∞—Å–∏–≤
    int end = start + visibleItems;    // –í–∏–∑–Ω–∞—á–∞—î–º –¥–æ —è–∫–æ–≥–æ –æ—Å—Ç–∞–Ω—å–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç—É –≤–∏–≤–æ–¥–∏—Ç–∏ –º–∞—Å–∏–≤
    for (int i = start; i < end && i < program_items; i++) {
        oled.setCursor(15, (i - start) * fontSize);
        oled.print(program_list[i]);
    }
    oled.setCursor(0, (current - start) * fontSize);
    oled.print(">");





    oled.update();
  
  }
}


// ----- –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –ø—Ä–æ–≥—Ä–∞–º ----- // 
void openProgram(int index) {
  switch (index) {        // —É —Ü—ñ–π —Ñ—É–Ω–∫—Ü—ñ—ó –º–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –∞–±–æ —Å—á–∏—Ç—É—î–º –ø—Ä–æ–≥—Ä–∞–º—É –∑ SD –∫–∞—Ä—Ç–∫–∏ —Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º
                          // –≤–∞–∂–ª–∏–≤–æ –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Å—Ç–∞–Ω MENU
                          // —è–∫—â–æ –º–∏ —Å—á–∏—Ç—É—î–º –ø—Ä–æ–≥—Ä–∞–º—É –∑ SD —Ç–æ –º—ñ–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –ø–µ—Ä–µ–ø—Ä–æ—à–∏–≤–∞—î—Ç—å—Å—è —â–æ–± —ó—ó –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–æ–º—É —É –ø—Ä–æ–≥—Ä–∞–º–∞—Ö –∑ SD
                          // –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏—Ö–æ–¥—É —â–æ–± –Ω–∞–∑–∞–¥ –ø–µ—Ä–µ–ø—Ä–æ—à–∏–≤–∞—Ç–∏—Å—è –Ω–∞ SD –©–æ–± —Ü–µ –∑—Ä–æ–±–∏—Ç–∏ —Ç–æ —Ç—Ä–µ–±–∞ –∑–∞–ø–∏—Å—á–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ–π–µ—Ü —Å–∏—Å—Ç–µ–º—É —Ç–µ–∂ –Ω–∞
                          // SD –∫–∞—Ä—Ç—É.
      case 0: state = APP_SETTINGS; break;          // –ü—Ä–æ–≥—Ä–∞–º–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Å—Ç—Ä–æ—î–Ω–∞ –≤ OS
      case 1: state = APP__WiFiMANAGER; break;      // –ü—Ä–æ–≥—Ä–∞–º–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–∞–π—Ñ–∞–π –≤—Å—Ç—Ä–æ—î–Ω–∞ –≤ OS
      case 2: state = APP_CLOCK; break;             // –ü—Ä–æ–≥—Ä–∞–º–∞ —á–∞—Å–∏, —Ç–∞–π–º–µ—Ä –≤—Å—Ç—Ä–æ—î–Ω–∞ –≤ OS
      case 3: state = APP_FILEEXPLORER; break;      // –ü—Ä–æ–≥—Ä–∞–º–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª–∞–º–∏ –Ω–∞ SD –∫–∞—Ä—Ç–∏ –≤—Å—Ç—Ä–æ—î–Ω–∞ –≤ OS
      case 4: state = APP_SYSTEMINFO; break;        // –ü—Ä–æ–≥—Ä–∞–º–∞ –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –≤—Å—Ç—Ä–æ—î–Ω–∞ –≤ OS
      case 5: state = APP_UPDATER; break;           // –ü—Ä–æ–≥—Ä–∞–º–∞ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ —á–µ—Ä–µ–∑ WiFi –≤—Å—Ç—Ä–æ—î–Ω–∞ –≤ OS
      case 6: state = APP_CALKULATOR; break;        // –ü—Ä–æ–≥—Ä–∞–º–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤—Å—Ç—Ä–æ—î–Ω–∞ –≤ OS
      case 7: state = APP_NOTES; break;             // –ü—Ä–æ–≥—Ä–∞–º–∞ –Ω–æ—Ç–∞—Ç–∫–∏ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS
      case 8: firmwarePath = "/apps/Paint.bin"; loading_SD_program(); break;      // Paint" –ù–µ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ SD 
      case 9: firmwarePath = "/apps/Gallery.bin"; loading_SD_program(); break;    // Gallery –ù–µ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ SD
      case 10: firmwarePath = "/apps/Music.bin"; loading_SD_program(); break;     // Music Player –ù–µ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ SD
      case 11: state = APP_TERMINAL; break;         // –ü—Ä–æ–≥—Ä–∞–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è OS –≤—Å—Ç—Ä–æ—î–Ω–∞ –≤ OS
      case 12: state = APP_BROSWER; break;          // –ü—Ä–æ–≥—Ä–∞–º–∞ –ø–æ—à—É–∫—É –≤ —Å–∏—Å—Ç–µ–º–∞—Ö –≥—É–≥–ª 2 –≤–µ—Ä—Å—ñ—ó –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS —Ç–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ SD
      case 13: firmwarePath = "/apps/Snake.bin"; loading_SD_program(); break;     // Snake –ù–µ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ SD
      case 14: firmwarePath = "/apps/Tetris.bin"; loading_SD_program(); break;    // Tetris –ù–µ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ SD
      case 15: firmwarePath = "/apps/2048.bin"; loading_SD_program(); break;      // 2048 –ù–µ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ SD
      case 16: firmwarePath = "/apps/DoomMini.bin"; loading_SD_program(); break;  // Doom Mini –ù–µ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ SD
      case 17: firmwarePath = "/apps/FlappyBird.bin"; loading_SD_program(); break;// Flappy Bird –ù–µ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ SD
      case 18: firmwarePath = "/apps/pong.bin"; loading_SD_program(); break;      // Pong –ù–µ –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ OS –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ SD
  }
}












// ----- –ó–ê–ú–ï–¢–ö–ò –° –ö–û–ú–ê–ù–î–ê–ú–ò –¢–ê –ü–†–ò–ö–õ–ê–î–ê–ú–ò –ö–û–î–£ ----- // 
  // file = SD.open("/test.txt", FILE_WRITE); // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º —Ñ–∞–π–ª –Ω–∞ SD –∫–∞—Ä—Ç—ñ /test.txt —è–∫—â–æ —Ç–∞–∫–æ–≥–æ —Ñ–∞–π–ª—É –Ω–µ–º–∞ —Ç–æ —Å—Ç–≤–æ—Ä—é—î–º —É –∫–æ—Ä–µ–Ω—ñ SD
  // if (file) {  // –ü—Ä–∞—Ü—é—î–º —Å —Ñ–∞–π–ª–æ–º
  //   file.println("Hello ESP32 mini OS"); // –∑–∞–ø–∏—Å—É—î–º —É —Ñ–∞–π–ª test.txt —Ç–µ–∫—Å—Ç
  //   file.println("–ü—Ä–∏–≤—ñ—Ç");
  //   file.close(); // –ó–∞–∫—Ä–∏–≤–∞—î–º —Ñ–∞–π–ª —â–æ–± –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–ª–∏—Å—è
  // }

  // file = SD.open("/test.txt"); // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º —Ñ–∞–π–ª —É —Ä–µ–∂–∏–º—ñ —á–∏—Ç–∞–Ω–Ω—è
  // if (file) {
  //   while (file.available()) { // –¶–∏–∫–ª –Ω–µ –∑–∞–∫—ñ–Ω—á–∏—Ç—Å—è –ø–æ–∫–∏ —î –¥–∞–Ω—ñ —É —Ñ–∞–π–ª—ñ
  //     Serial.write(file.read());
  //   }
  //   file.close();
  // }

  // if (!SD.exists("/data")) { // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º —á–∏ —ñ—Å–Ω—É—î –ø–∞–ø–∫–∞ data 
  //   SD.mkdir("/data");       // –Ø–∫—â–æ —Ç–∞–∫–æ—ó –ø–∞–ø–∫–∏ –Ω–µ —ñ—Å–Ω—É—î —Ç–æ —Å—Ç–≤–æ—Ä—é—î–º —ó—ó 
  //   Serial.println("Winerr");
  // }
  // SD.rmdir("/data");         // –í–∏–¥–∞–ª–∏—Ç–∏ –ø–∞–ø–∫—É/—Ç–µ–∫—É/—Ñ–∞–π–ª  